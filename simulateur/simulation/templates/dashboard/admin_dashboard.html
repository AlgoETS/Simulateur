{% include 'includes/header.html' %}

<body class="bg-gray-100 text-gray-800">
    <div class="container mx-auto p-6">
        <h1 class="text-3xl font-bold mb-6">Admin Dashboard</h1>
        {% include 'includes/navigation.html' %}

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-6">
            <!-- Create and List Events -->
            <div class="bg-white shadow rounded p-4">
                <h3 class="text-xl font-semibold mb-2">Manage Events</h3>
                <form method="post" action="{% url 'create_event' %}">
                    {% csrf_token %}
                    {{ event_form.as_p }}
                    <button type="submit" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Create Event</button>
                </form>
                <h4 class="mt-4 font-semibold">Existing Events</h4>
                <ul>
                    {% for event in events %}
                    <li class="flex justify-between">
                        {{ event.name }}
                        <form method="post" action="{% url 'delete_event' event.id %}" class="inline">
                            {% csrf_token %}
                            <button type="submit" class="text-red-500 hover:text-red-700">Delete</button>
                        </form>
                    </li>
                    {% endfor %}
                </ul>
            </div>

            <!-- Create and List Triggers -->
            <div class="bg-white shadow rounded p-4">
                <h3 class="text-xl font-semibold mb-2">Manage Triggers</h3>
                <form method="post" action="{% url 'create_trigger' %}">
                    {% csrf_token %}
                    {{ trigger_form.as_p }}
                    <button type="submit" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Create Trigger</button>
                </form>
                <h4 class="mt-4 font-semibold">Existing Triggers</h4>
                <ul>
                    {% for trigger in triggers %}
                    <li class="flex justify-between">
                        {{ trigger.name }}
                        <form method="post" action="{% url 'delete_trigger' trigger.id %}" class="inline">
                            {% csrf_token %}
                            <button type="submit" class="text-red-500 hover:text-red-700">Delete</button>
                        </form>
                    </li>
                    {% endfor %}
                </ul>
            </div>

            <!-- Create and List News -->
            <div class="bg-white shadow rounded p-4">
                <h3 class="text-xl font-semibold mb-2">Manage News</h3>
                <form method="post" action="{% url 'create_news' %}">
                    {% csrf_token %}
                    {{ news_form.as_p }}
                    <button type="submit" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Create News</button>
                </form>
                <h4 class="mt-4 font-semibold">Existing News</h4>
                <ul>
                    {% for news in news_list %}
                    <li class="flex justify-between">
                        {{ news.title }}
                        <form method="post" action="{% url 'delete_news' news.id %}" class="inline">
                            {% csrf_token %}
                            <button type="submit" class="text-red-500 hover:text-red-700">Delete</button>
                        </form>
                    </li>
                    {% endfor %}
                </ul>
            </div>

            <!-- Create and List Companies -->
            <div class="bg-white shadow rounded p-4">
                <h3 class="text-xl font-semibold mb-2">Manage Companies</h3>
                <form method="post" action="{% url 'create_company' %}">
                    {% csrf_token %}
                    {{ company_form.as_p }}
                    <button type="submit" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Create Company</button>
                </form>
                <h4 class="mt-4 font-semibold">Existing Companies</h4>
                <ul>
                    {% for company in companies %}
                    <li class="flex justify-between">
                        {{ company.name }}
                        <form method="post" action="{% url 'delete_company' company.id %}" class="inline">
                            {% csrf_token %}
                            <button type="submit" class="text-red-500 hover:text-red-700">Delete</button>
                        </form>
                    </li>
                    {% endfor %}
                </ul>
            </div>

            <!-- Create and List Stocks -->
            <div class="bg-white shadow rounded p-4">
                <h3 class="text-xl font-semibold mb-2">Manage Stocks</h3>
                <form method="post" action="{% url 'create_stock' %}">
                    {% csrf_token %}
                    {{ stock_form.as_p }}
                    <button type="submit" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Create Stock</button>
                </form>
                <h4 class="mt-4 font-semibold">Existing Stocks</h4>
                <ul>
                    {% for stock in stocks %}
                    <li class="flex justify-between">
                        {{ stock.ticker }}
                        <form method="post" action="{% url 'delete_stock' stock.id %}" class="inline">
                            {% csrf_token %}
                            <button type="submit" class="text-red-500 hover:text-red-700">Delete</button>
                        </form>
                    </li>
                    {% endfor %}
                </ul>
            </div>

            <!-- Simulation Settings -->
            <div class="bg-white shadow rounded p-4">
                <h3 class="text-xl font-semibold mb-2">Simulation Settings</h3>
                <form method="post" action="{% url 'simulation_settings' %}">
                    {% csrf_token %}
                    {{ settings_form.as_p }}
                    <button type="submit" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded">Save Settings</button>
                </form>
            </div>

            <!-- Create and List Scenarios -->
            <div class="bg-white shadow rounded p-4">
                <h3 class="text-xl font-semibold mb-2">Manage Scenarios</h3>
                <form method="post" action="{% url 'create_scenario' %}">
                    {% csrf_token %}
                    {{ scenario_form.as_p }}
                    <button type="submit" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Create Scenario</button>
                </form>
                <h4 class="mt-4 font-semibold">Existing Scenarios</h4>
                <ul>
                    {% for scenario in scenarios %}
                    <li class="flex justify-between">
                        {{ scenario.name }}
                        <form method="post" action="{% url 'delete_scenario' scenario.id %}" class="inline">
                            {% csrf_token %}
                            <button type="submit" class="text-red-500 hover:text-red-700">Delete</button>
                        </form>
                    </li>
                    {% endfor %}
                </ul>
            </div>
        </div>

        <div class="flex gap-4 mb-6">
            <button onclick="startSimulation()" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded">Start Simulation</button>
            <button onclick="pauseSimulation()" class="bg-yellow-500 hover:bg-yellow-700 text-white font-bold py-2 px-6 rounded">Pause Simulation</button>
            <button onclick="stopSimulation()" class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-6 rounded">Stop Simulation</button>
            <button onclick="fastForwardSimulation()" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-6 rounded">Fast Forward</button>
            <button onclick="rewindSimulation()" class="bg-purple-500 hover:bg-purple-700 text-white font-bold py-2 px-6 rounded">Rewind</button>
        </div>
    </div>
    <script>
        function saveSettings() {
            const settings = {
                max_users: document.getElementById('maxUsers').value,
                max_companies: document.getElementById('maxCompanies').value,
                timer_step: document.getElementById('timerStep').value,
                interval: document.getElementById('interval').value,
                max_interval: document.getElementById('maxInterval').value,
                fluctuation_rate: document.getElementById('fluctuationRate').value,
                time_unit: document.getElementById('timeUnit').value,
                close_stock_market_at_night: document.getElementById('closeMarketAtNight').checked,
                noise_function: document.getElementById('noiseFunction').value
            };

            fetch('/api/simulation/settings/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCookie('csrftoken')
                },
                body: JSON.stringify(settings)
            }).then(response => {
                if (response.ok) {
                    alert('Settings saved successfully');
                } else {
                    alert('Failed to save settings');
                }
            });
        }

        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        function startSimulation() {
            fetch('/api/simulation/start/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCookie('csrftoken')
                }
            }).then(response => {
                if (response.ok) {
                    alert('Simulation started successfully');
                } else {
                    alert('Failed to start simulation');
                }
            });
        }

        function pauseSimulation() {
            fetch('/api/simulation/pause/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCookie('csrftoken')
                }
            }).then(response => {
                if (response.ok) {
                    alert('Simulation paused successfully');
                } else {
                    alert('Failed to pause simulation');
                }
            });
        }

        function stopSimulation() {
            fetch('/api/simulation/stop/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCookie('csrftoken')
                }
            }).then(response => {
                if (response.ok) {
                    alert('Simulation stopped successfully');
                } else {
                    alert('Failed to stop simulation');
                }
            });
        }

        function fastForwardSimulation() {
            fetch('/api/simulation/fastforward/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCookie('csrftoken')
                }
            }).then(response => {
                if (response.ok) {
                    alert('Simulation fast forwarded successfully');
                } else {
                    alert('Failed to fast forward simulation');
                }
            });
        }

        function rewindSimulation() {
            fetch('/api/simulation/rewind/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCookie('csrftoken')
                }
            }).then(response => {
                if (response.ok) {
                    alert('Simulation rewinded successfully');
                } else {
                    alert('Failed to rewind simulation');
                }
            });
        }
    </script>
</body>